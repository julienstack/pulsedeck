@if (isLoggedIn()) {
<div class="hidden lg:flex fixed bottom-4 left-4 z-50 items-center gap-2">
    <!-- Main Alpha Badge -->
    <div class="bg-[var(--color-surface-raised)] text-[var(--color-text)] shadow-2xl backdrop-blur-md rounded-full px-4 py-2 cursor-pointer transition-all duration-300 hover:bg-[var(--color-surface-overlay)] hover:scale-105 border border-[var(--color-border)] flex items-center gap-2 group"
        (click)="toggleDialog()" (mouseenter)="onMouseEnter()" (mouseleave)="onMouseLeave()">

        <div class="relative flex h-2 w-2">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-amber-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-2 w-2 bg-amber-500"></span>
        </div>

        <div class="flex flex-col">
            <span class="font-bold text-xs tracking-wider uppercase text-amber-500">Alpha</span>
            <span
                class="font-semibold text-xs text-[var(--color-text-muted)] hidden group-hover:block transition-all duration-300">
                Produktiv-Build
            </span>
        </div>

        <div
            class="text-xs text-[var(--color-text-muted)] border-l border-[var(--color-border)] pl-2 ml-1 max-w-0 overflow-hidden whitespace-nowrap group-hover:max-w-xs transition-all duration-500 ease-in-out">
            Problem melden
        </div>

        <i class="pi pi-comment text-[var(--color-text-muted)] text-sm ml-1"></i>
    </div>

    <!-- Roadmap Button -->
    <button (click)="navigateToRoadmap()"
        class="bg-[var(--color-surface-raised)] text-[var(--color-text-muted)] shadow-2xl backdrop-blur-md rounded-full w-10 h-10 flex items-center justify-center cursor-pointer transition-all duration-300 hover:bg-[var(--color-surface-overlay)] hover:scale-110 hover:text-amber-500 border border-[var(--color-border)]"
        title="Roadmap anzeigen">
        <i class="pi pi-map text-sm"></i>
    </button>
</div>
}

<p-dialog header="Feedback & Wünsche" [visible]="visible()" (visibleChange)="visible.set($event)" [modal]="true"
    [style]="{ width: '90vw', maxWidth: '520px' }" [draggable]="false" [resizable]="false" [dismissableMask]="true"
    appendTo="body" styleClass="feedback-dialog">

    <div class="flex flex-col gap-6 py-2">
        <!-- Intro Text -->
        <p class="text-base text-[var(--color-text-muted)] leading-relaxed">
            Du hast einen Bug gefunden oder eine Idee? Lass es uns wissen!
        </p>

        <!-- Type Selection -->
        <div class="flex gap-3 w-full">
            <button type="button" (click)="type.set('suggestion')"
                class="flex-1 py-4 px-5 rounded-xl font-semibold text-sm transition-all duration-200 flex items-center justify-center gap-2 border-2"
                [class.bg-teal-900]="type() === 'suggestion' && isDarkMode()"
                [class.bg-teal-100]="type() === 'suggestion' && !isDarkMode()"
                [class.border-teal]="type() === 'suggestion'" [class.text-teal]="type() === 'suggestion'"
                [class.bg-[var(--color-surface-raised)]]="type() !== 'suggestion'"
                [class.border-[var(--color-border)]]="type() !== 'suggestion'"
                [class.text-[var(--color-text-muted)]]="type() !== 'suggestion'"
                [class.hover:bg-[var(--color-surface-overlay)]]="type() !== 'suggestion'">
                <i class="pi pi-lightbulb text-lg"></i>
                <span>Vorschlag</span>
            </button>
            <button type="button" (click)="type.set('bug')"
                class="flex-1 py-4 px-5 rounded-xl font-semibold text-sm transition-all duration-200 flex items-center justify-center gap-2 border-2"
                [class.bg-rose-900]="type() === 'bug' && isDarkMode()"
                [class.bg-rose-100]="type() === 'bug' && !isDarkMode()" [class.border-rose-500]="type() === 'bug'"
                [class.text-rose-500]="type() === 'bug'" [class.bg-[var(--color-surface-raised)]]="type() !== 'bug'"
                [class.border-[var(--color-border)]]="type() !== 'bug'"
                [class.text-[var(--color-text-muted)]]="type() !== 'bug'"
                [class.hover:bg-[var(--color-surface-overlay)]]="type() !== 'bug'">
                <i class="pi pi-exclamation-triangle text-lg"></i>
                <span>Fehlermeldung</span>
            </button>
        </div>

        <!-- Description Field -->
        <div class="flex flex-col gap-3">
            <label for="feedback-desc" class="font-semibold text-sm text-[var(--color-text)]">
                Beschreibung
            </label>
            <textarea pInputTextarea id="feedback-desc" [ngModel]="description()"
                (ngModelChange)="description.set($event)" rows="5"
                placeholder="Beschreibe den Bug oder deinen Vorschlag möglichst genau..."
                class="w-full !resize-none !text-base !bg-[var(--color-surface)] !text-[var(--color-text)] !border-[var(--color-border)] !rounded-xl !p-4 focus:!border-linke focus:!ring-linke/20 placeholder:!text-[var(--color-text-muted)]">
            </textarea>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-end gap-3 pt-2 border-t border-[var(--color-border)]">
            <button type="button" (click)="visible.set(false)"
                class="px-5 py-2.5 rounded-lg font-medium text-sm text-[var(--color-text-muted)] hover:text-[var(--color-text)] hover:bg-[var(--color-surface-overlay)] transition-all">
                Abbrechen
            </button>
            <button type="button" (click)="submitFeedback()" [disabled]="loading()"
                class="px-6 py-2.5 rounded-lg font-semibold text-sm bg-linke hover:bg-linke-light text-white transition-all flex items-center gap-2 shadow-lg shadow-linke/20 disabled:opacity-50 disabled:cursor-not-allowed">
                @if (loading()) {
                <i class="pi pi-spin pi-spinner"></i>
                } @else {
                <i class="pi pi-send"></i>
                }
                <span>Absenden</span>
            </button>
        </div>
    </div>
</p-dialog>
<p-toast position="bottom-center" key="feedback-toast"></p-toast>