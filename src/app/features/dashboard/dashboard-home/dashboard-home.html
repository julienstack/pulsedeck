<div class="p-2 md:p-6 space-y-6">

    <!-- Welcome Header -->
    @if (auth.isLoggedIn()) {
    <div
        class="bg-gradient-to-r from-linke/10 via-teal/5 to-transparent rounded-xl p-4 md:p-6 border border-[var(--color-border)]">
        <div class="flex items-start justify-between">
            <div>
                <h1 class="text-xl md:text-2xl font-bold text-[var(--color-text)]">
                    {{ getGreeting() }}, {{ (auth.currentMember()?.name?.split(' '))?.[0] ?? 'Mitglied' }}!
                </h1>
                <p class="text-[var(--color-text-muted)] text-sm mt-1">
                    {{ getMemberSinceText() }}
                </p>
            </div>
            @if (isNewMember) {
            <span class="bg-teal/20 text-teal text-xs font-medium px-2 py-1 rounded-full">
                <i class="pi pi-sparkles mr-1"></i>Neu
            </span>
            }
        </div>
    </div>
    } @else {
    <h1 class="text-xl md:text-3xl font-bold text-[var(--color-text)]">Willkommen!</h1>
    }

    <!-- Onboarding Checklist (for new members or incomplete onboarding) -->
    @if (auth.isLoggedIn() && !onboardingService.isComplete()) {
    <div class="bg-[var(--color-surface-raised)] rounded-xl border border-[var(--color-border)] p-4 md:p-5">
        <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-2">
                <div class="p-2 bg-linke/10 rounded-lg">
                    <i class="pi pi-flag text-linke"></i>
                </div>
                <div>
                    <h3 class="font-semibold text-[var(--color-text)]">Erste Schritte</h3>
                    <p class="text-xs text-[var(--color-text-muted)]">
                        {{ onboardingService.completedCount() }} von {{ onboardingService.totalSteps() }} erledigt
                    </p>
                </div>
            </div>
            <span class="text-sm font-bold text-linke">{{ onboardingService.progress() }}%</span>
        </div>

        <!-- Progress Bar -->
        <div class="w-full h-2 bg-[var(--color-surface-overlay)] rounded-full overflow-hidden mb-4">
            <div class="h-full bg-gradient-to-r from-linke to-teal rounded-full transition-all duration-500"
                [style.width.%]="onboardingService.progress()"></div>
        </div>

        <!-- Steps Grid -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-2">
            @for (step of onboardingService.steps(); track step.key) {
            <a [routerLink]="getStepLink(step.key)" class="flex flex-col items-center p-2 rounded-lg transition-colors"
                [class.bg-teal/10]="step.completed" [class.bg-[var(--color-surface-overlay)]]="!step.completed"
                [class.opacity-50]="step.completed" [class.cursor-pointer]="!step.completed"
                [class.hover:bg-teal/5]="!step.completed" [pTooltip]="step.completed ? 'Erledigt!' : step.description"
                tooltipPosition="bottom">
                <div class="w-8 h-8 rounded-full flex items-center justify-center mb-1" [class.bg-teal]="step.completed"
                    [class.bg-[var(--color-border)]]="!step.completed">
                    @if (step.completed) {
                    <i class="pi pi-check text-white text-xs"></i>
                    } @else {
                    <i class="pi {{ step.icon }} text-[var(--color-text-muted)] text-xs"></i>
                    }
                </div>
                <span class="text-[10px] text-center text-[var(--color-text)] leading-tight">
                    {{ step.label }}
                </span>
            </a>
            }
        </div>
    </div>
    }

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6">

        <!-- Left Column: My AGs + My Events -->
        <div class="lg:col-span-2 space-y-4 md:space-y-6">

            <!-- My Working Groups -->
            @if (auth.isLoggedIn()) {
            <div class="bg-[var(--color-surface-raised)] rounded-xl border border-[var(--color-border)] p-4 md:p-5">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <div class="p-2 bg-linke/10 rounded-lg">
                            <i class="pi pi-briefcase text-linke"></i>
                        </div>
                        <h3 class="font-semibold text-[var(--color-text)]">Meine Arbeitsgruppen</h3>
                    </div>
                    <a routerLink="ags"
                        class="text-xs text-[var(--color-text-muted)] hover:text-linke transition-colors">
                        Alle AGs <i class="pi pi-arrow-right text-[10px] ml-0.5"></i>
                    </a>
                </div>

                @if (myWorkingGroups.length > 0) {
                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                    @for (ag of myWorkingGroups; track ag.id) {
                    <a routerLink="ags"
                        class="flex items-center gap-3 p-3 rounded-lg bg-[var(--color-surface-overlay)] hover:bg-linke/10 border border-[var(--color-border)] hover:border-linke/30 transition-colors group">
                        <div class="w-10 h-10 rounded-lg bg-linke/20 flex items-center justify-center">
                            <i class="pi pi-users text-linke"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="font-medium text-[var(--color-text)] text-sm group-hover:text-linke truncate">
                                {{ ag.name }}
                            </div>
                            <div class="text-xs text-[var(--color-text-muted)]">
                                {{ ag.members_count }} Mitglieder
                            </div>
                        </div>
                        <i
                            class="pi pi-chevron-right text-xs text-[var(--color-text-muted)] group-hover:text-linke"></i>
                    </a>
                    }
                </div>
                } @else {
                <div class="text-center py-6">
                    <div
                        class="w-12 h-12 mx-auto mb-3 rounded-full bg-[var(--color-surface-overlay)] flex items-center justify-center">
                        <i class="pi pi-users text-xl text-[var(--color-text-muted)]"></i>
                    </div>
                    <p class="text-sm text-[var(--color-text-muted)] mb-3">
                        Du bist noch keiner AG beigetreten
                    </p>
                    <a routerLink="ags" class="inline-flex items-center gap-1.5 text-sm text-linke hover:underline">
                        <i class="pi pi-plus text-xs"></i>
                        AG beitreten
                    </a>
                </div>
                }
            </div>
            }

            <!-- My Upcoming Events -->
            @if (auth.isLoggedIn()) {
            <div class="bg-[var(--color-surface-raised)] rounded-xl border border-[var(--color-border)] p-4 md:p-5">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <div class="p-2 bg-teal/10 rounded-lg">
                            <i class="pi pi-calendar text-teal"></i>
                        </div>
                        <h3 class="font-semibold text-[var(--color-text)]">Meine nächsten Termine</h3>
                    </div>
                    <a routerLink="calendar"
                        class="text-xs text-[var(--color-text-muted)] hover:text-teal transition-colors">
                        Kalender <i class="pi pi-arrow-right text-[10px] ml-0.5"></i>
                    </a>
                </div>

                @if (myUpcomingEvents.length > 0) {
                <div class="space-y-2">
                    @for (event of myUpcomingEvents; track event.id) {
                    <div
                        class="flex items-center gap-3 p-3 rounded-lg bg-[var(--color-surface-overlay)] border border-[var(--color-border)] hover:border-{{ getEventColor(event) }}/30 transition-colors">
                        <div class="w-10 h-10 rounded-lg flex items-center justify-center"
                            [class]="'bg-' + getEventColor(event) + '/20'">
                            <i class="pi {{ getEventIcon(event) }}" [class]="'text-' + getEventColor(event)"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="font-medium text-[var(--color-text)] text-sm truncate">
                                {{ event.title }}
                            </div>
                            <div class="text-xs text-[var(--color-text-muted)] flex items-center gap-2">
                                <span class="flex items-center gap-1">
                                    <i class="pi pi-clock text-[10px]"></i>
                                    {{ event.start_time }}
                                </span>
                                @if (event.location) {
                                <span class="flex items-center gap-1">
                                    <i class="pi pi-map-marker text-[10px]"></i>
                                    {{ event.location }}
                                </span>
                                }
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-xs font-medium px-2 py-1 rounded-full"
                                [class]="formatEventDate(event.date) === 'Heute' ? 'bg-linke/20 text-linke' : 'bg-[var(--color-surface-raised)] text-[var(--color-text-muted)]'">
                                {{ formatEventDate(event.date) }}
                            </span>
                        </div>
                    </div>
                    }
                </div>
                } @else {
                <div class="text-center py-6">
                    <div
                        class="w-12 h-12 mx-auto mb-3 rounded-full bg-[var(--color-surface-overlay)] flex items-center justify-center">
                        <i class="pi pi-calendar text-xl text-[var(--color-text-muted)]"></i>
                    </div>
                    <p class="text-sm text-[var(--color-text-muted)]">
                        Keine anstehenden Termine
                    </p>
                </div>
                }
            </div>
            }
        </div>

        <!-- Right Column: Statistics Cards -->
        <div class="space-y-4">

            <!-- Stats Overview Cards -->
            <div class="grid grid-cols-2 lg:grid-cols-1 gap-3">

                <!-- Members Stats Card -->
                <a routerLink="members"
                    class="bg-[var(--color-surface-raised)] p-3 md:p-4 rounded-xl border border-[var(--color-border)] hover:border-linke/50 transition-colors cursor-pointer group shadow-sm">
                    <div class="flex items-center gap-3">
                        <div class="p-2 md:p-3 bg-linke/10 rounded-lg group-hover:bg-linke/20 transition-colors">
                            <i class="pi pi-users text-lg md:text-xl text-linke"></i>
                        </div>
                        <div class="flex-1">
                            <div class="text-xl md:text-2xl font-bold text-[var(--color-text)]">
                                {{ statsService.stats()?.totalMembers ?? '–' }}
                            </div>
                            <p class="text-[var(--color-text-muted)] text-xs">Mitglieder</p>
                        </div>
                        @if (statsService.stats()?.activeMembers) {
                        <div class="text-right hidden md:block">
                            <span class="text-xs font-medium text-teal">
                                {{ statsService.stats()?.activeMembers }} aktiv
                            </span>
                        </div>
                        }
                    </div>
                </a>

                <!-- Events Stats Card -->
                <a routerLink="calendar"
                    class="bg-[var(--color-surface-raised)] p-3 md:p-4 rounded-xl border border-[var(--color-border)] hover:border-teal/50 transition-colors cursor-pointer group shadow-sm">
                    <div class="flex items-center gap-3">
                        <div class="p-2 md:p-3 bg-teal/10 rounded-lg group-hover:bg-teal/20 transition-colors">
                            <i class="pi pi-calendar text-lg md:text-xl text-teal"></i>
                        </div>
                        <div class="flex-1">
                            <div class="text-xl md:text-2xl font-bold text-[var(--color-text)]">
                                {{ statsService.stats()?.upcomingEvents ?? '–' }}
                            </div>
                            <p class="text-[var(--color-text-muted)] text-xs">Termine</p>
                        </div>
                        @if (statsService.stats()?.eventsThisMonth) {
                        <div class="text-right hidden md:block">
                            <span class="text-xs font-medium text-[var(--color-text-muted)]">
                                {{ statsService.stats()?.eventsThisMonth }} diesen Monat
                            </span>
                        </div>
                        }
                    </div>
                </a>

                <!-- Wiki Stats Card -->
                <a routerLink="wiki"
                    class="bg-[var(--color-surface-raised)] p-3 md:p-4 rounded-xl border border-[var(--color-border)] hover:border-violet/50 transition-colors cursor-pointer group shadow-sm">
                    <div class="flex items-center gap-3">
                        <div class="p-2 md:p-3 bg-violet/10 rounded-lg group-hover:bg-violet/20 transition-colors">
                            <i class="pi pi-book text-lg md:text-xl text-violet"></i>
                        </div>
                        <div class="flex-1">
                            <div class="text-xl md:text-2xl font-bold text-[var(--color-text)]">
                                {{ statsService.stats()?.totalWikiArticles ?? '–' }}
                            </div>
                            <p class="text-[var(--color-text-muted)] text-xs">Wiki-Artikel</p>
                        </div>
                    </div>
                </a>

                <!-- Files Stats Card -->
                <a routerLink="files"
                    class="bg-[var(--color-surface-raised)] p-3 md:p-4 rounded-xl border border-[var(--color-border)] hover:border-amber-500/50 transition-colors cursor-pointer group shadow-sm">
                    <div class="flex items-center gap-3">
                        <div
                            class="p-2 md:p-3 bg-amber-500/10 rounded-lg group-hover:bg-amber-500/20 transition-colors">
                            <i class="pi pi-folder text-lg md:text-xl text-amber-500"></i>
                        </div>
                        <div class="flex-1">
                            <div class="text-xl md:text-2xl font-bold text-[var(--color-text)]">
                                {{ statsService.stats()?.totalFiles ?? '–' }}
                            </div>
                            <p class="text-[var(--color-text-muted)] text-xs">Dateien</p>
                        </div>
                    </div>
                </a>

                <!-- Feed Stats Card -->
                <a routerLink="feed"
                    class="bg-[var(--color-surface-raised)] p-3 md:p-4 rounded-xl border border-[var(--color-border)] hover:border-linke/50 transition-colors cursor-pointer group shadow-sm col-span-2 lg:col-span-1">
                    <div class="flex items-center gap-3">
                        <div class="p-2 md:p-3 bg-linke/10 rounded-lg group-hover:bg-linke/20 transition-colors">
                            <i class="pi pi-megaphone text-lg md:text-xl text-linke"></i>
                        </div>
                        <div class="flex-1">
                            <div class="text-xl md:text-2xl font-bold text-[var(--color-text)]">
                                {{ statsService.stats()?.totalFeedItems ?? '–' }}
                            </div>
                            <p class="text-[var(--color-text-muted)] text-xs">News-Beiträge</p>
                        </div>
                        <div class="text-right hidden md:block">
                            <span class="text-xs font-medium text-[var(--color-text-muted)]">
                                {{ statsService.stats()?.totalWorkingGroups ?? 0 }} AGs
                            </span>
                        </div>
                    </div>
                </a>

            </div>

        </div>
    </div>

</div>