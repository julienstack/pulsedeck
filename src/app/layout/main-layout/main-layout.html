<div class="flex h-screen bg-[var(--color-bg)] text-[var(--color-text)] overflow-hidden">
    <!-- Left Sidebar (Desktop) -->
    <aside
        class="hidden lg:flex w-64 flex-col border-r border-[var(--color-border)] bg-[var(--color-surface)] p-4 z-20">
        <app-sidebar-left></app-sidebar-left>
    </aside>

    <!-- Main Content Wrapper -->
    <div class="flex-1 flex flex-col min-w-0 h-full relative">
        <!-- Mobile Header -->
        <header
            class="lg:hidden flex items-center justify-between p-4 bg-[var(--color-surface)] border-b border-[var(--color-border)] z-10 sticky top-0">
            <p-button icon="pi pi-bars" [text]="true" (click)="leftSidebarVisible.set(true)"
                styleClass="text-[var(--color-text-muted)] hover:text-[var(--color-text)]" />
            <span class="text-lg font-bold text-linke">PulseDeck</span>
            <p-button icon="pi pi-calendar" [text]="true" (click)="rightSidebarVisible.set(true)"
                styleClass="text-[var(--color-text-muted)] hover:text-[var(--color-text)]" />
        </header>

        <!-- Main Content Scroll Area -->
        <main class="flex-1 overflow-y-auto p-4 lg:p-8 scroll-smooth flex flex-col"
            [@workspaceAnimation]="orgService.currentSlug()">
            <div class="flex-1">
                <router-outlet></router-outlet>
            </div>

            <!-- Footer -->
            <footer class="mt-8 pt-6 border-t border-[var(--color-border)]">
                <div
                    class="flex flex-col md:flex-row items-center justify-between gap-4 text-xs text-[var(--color-text-muted)]">
                    <div class="flex items-center gap-3">
                        <!-- Mobile/Tablet: Helper Buttons -->
                        <div class="lg:hidden flex items-center gap-3">
                            <div class="flex items-center gap-1.5 cursor-pointer hover:bg-[var(--color-surface-overlay)] px-2 py-1 -ml-2 rounded-lg transition-colors group"
                                (click)="feedbackBadge.toggleDialog()" title="Feedback & Bugreport">
                                <span class="font-semibold text-linke">PulseDeck</span>
                                <span
                                    class="text-[10px] font-bold bg-amber-500/10 text-amber-500 px-1.5 py-0.5 rounded border border-amber-500/20 group-hover:bg-amber-500/20 transition-colors">ALPHA</span>
                            </div>

                            <button (click)="feedbackBadge.navigateToRoadmap()"
                                class="p-1.5 w-7 h-7 flex items-center justify-center rounded-lg hover:bg-[var(--color-surface-overlay)] transition-colors text-[var(--color-text-muted)] hover:text-amber-500"
                                title="Roadmap">
                                <i class="pi pi-map text-xs"></i>
                            </button>
                        </div>

                        <!-- Desktop: Static Text (Badge is floating) -->
                        <div class="hidden lg:flex items-center gap-2">
                            <span class="font-semibold text-linke">PulseDeck</span>
                            <span>v0.9.0 Alpha</span>
                        </div>

                        <span class="hidden md:inline text-[var(--color-border)]">•</span>
                        <span class="hidden md:inline">© 2026 Julien Lieske</span>
                    </div>
                    <div class="flex items-center gap-4">
                        <button (click)="theme.toggle()"
                            class="p-1.5 w-8 h-8 flex items-center justify-center rounded-lg hover:bg-[var(--color-surface-overlay)] transition-colors text-[var(--color-text-muted)] hover:text-linke"
                            [title]="theme.isDark() ? 'Light Mode aktivieren' : 'Dark Mode aktivieren'">
                            <i class="pi text-sm" [class.pi-moon]="theme.isDark()" [class.pi-sun]="!theme.isDark()"></i>
                        </button>
                        <div class="w-px h-4 bg-[var(--color-border)] mx-1"></div>
                        <a routerLink="/impressum" class="hover:text-linke transition-colors">Impressum</a>
                        <a routerLink="/datenschutz" class="hover:text-linke transition-colors">Datenschutz</a>
                        <a routerLink="/docs" class="hover:text-linke transition-colors">Handbuch</a>
                        <a href="mailto:support@example.com" class="hover:text-linke transition-colors">Hilfe</a>
                    </div>
                </div>
            </footer>
        </main>
    </div>

    <!-- Right Sidebar (Desktop) - Collapsible -->
    @if (!rightSidebarCollapsed()) {
    <aside
        class="hidden xl:flex w-72 flex-col border-l border-[var(--color-border)] bg-[var(--color-surface)] p-4 z-20 relative">
        <!-- Collapse Button -->
        <button (click)="toggleRightSidebar()" pTooltip="Sidebar einklappen" tooltipPosition="left"
            class="absolute -left-3 top-1/2 -translate-y-1/2 w-6 h-12 bg-[var(--color-surface-raised)] border border-[var(--color-border)] rounded-l-lg flex items-center justify-center text-[var(--color-text-muted)] hover:text-[var(--color-text)] hover:bg-[var(--color-surface-overlay)] transition-colors z-30">
            <i class="pi pi-chevron-right text-xs"></i>
        </button>
        <app-sidebar-right></app-sidebar-right>
    </aside>
    } @else {
    <!-- Collapsed Sidebar - Just a toggle button -->
    <div
        class="hidden xl:flex flex-col items-center py-4 px-1 border-l border-[var(--color-border)] bg-[var(--color-surface)] z-20">
        <button (click)="toggleRightSidebar()" pTooltip="Sidebar ausklappen" tooltipPosition="left"
            class="w-8 h-8 bg-[var(--color-surface-raised)] border border-[var(--color-border)] rounded-lg flex items-center justify-center text-[var(--color-text-muted)] hover:text-[var(--color-text)] hover:bg-[var(--color-surface-overlay)] transition-colors">
            <i class="pi pi-chevron-left text-xs"></i>
        </button>
        <!-- Quick icons when collapsed -->
        <div class="mt-4 space-y-2">
            <button (click)="toggleRightSidebar()" pTooltip="Termine" tooltipPosition="left"
                class="w-8 h-8 bg-[var(--color-surface-raised)] rounded-lg flex items-center justify-center text-[var(--color-text-muted)] hover:text-linke transition-colors">
                <i class="pi pi-calendar text-sm"></i>
            </button>
            <button (click)="toggleRightSidebar()" pTooltip="Aufgaben" tooltipPosition="left"
                class="w-8 h-8 bg-[var(--color-surface-raised)] rounded-lg flex items-center justify-center text-[var(--color-text-muted)] hover:text-teal transition-colors">
                <i class="pi pi-check-circle text-sm"></i>
            </button>
        </div>
    </div>
    }
</div>

<!-- Mobile Left Drawer (Navigation) -->
<p-drawer [(visible)]="leftSidebarVisible" position="left"
    [styleClass]="'!bg-[var(--color-surface)] !border-r !border-[var(--color-border)] !w-[85vw] max-w-xs'"
    [modal]="true" [dismissible]="true">
    <ng-template pTemplate="content">
        <div class="h-full py-2">
            <app-sidebar-left></app-sidebar-left>
        </div>
    </ng-template>
</p-drawer>

<!-- Mobile Right Drawer (Widgets) -->
<p-drawer [(visible)]="rightSidebarVisible" position="right"
    [styleClass]="'!bg-[var(--color-surface)] !border-l !border-[var(--color-border)] !w-[85vw] max-w-xs'"
    [modal]="true" [dismissible]="true">
    <ng-template pTemplate="content">
        <div class="h-full py-2">
            <app-sidebar-right></app-sidebar-right>
        </div>
    </ng-template>
</p-drawer>

<app-feedback-badge #feedbackBadge></app-feedback-badge>